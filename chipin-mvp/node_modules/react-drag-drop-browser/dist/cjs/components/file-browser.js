"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = FileBrowser;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const join_classes_1 = require("../lib/join-classes");
function FileBrowser(props) {
    const { dataTestId = "file-browser", inputId = "input-id", maxSizeInMB = 1, multiple = false, allowedFileTypes = [".pdf", ".jpeg", ".png", ".jpg"], pickerBtnText = "Click here to browse files", pickerBtnClassName = "file-browser-button", render = undefined, onSelectFiles, } = props;
    const sizeInBytes = maxSizeInMB * 1024 * 1024;
    const isStringPicker = typeof pickerBtnText === "string";
    const nopickerBtnText = pickerBtnText === null ||
        pickerBtnText === undefined ||
        (typeof pickerBtnText === "string" && pickerBtnText === "");
    const inputRef = (0, react_1.useRef)();
    const pickFileHandler = (e) => {
        e.preventDefault();
        e.stopPropagation();
        const fileArray = Array.from(e.target.files).filter((file) => file.size <= sizeInBytes);
        onSelectFiles(fileArray);
    };
    if (render === undefined && nopickerBtnText) {
        return ((0, jsx_runtime_1.jsxs)("p", { "data-testid": "invalid-component", children: ["You must provide a ", (0, jsx_runtime_1.jsx)("code", { children: "render" }), " prop or", " ", (0, jsx_runtime_1.jsx)("code", { children: "pickerBtnText" }), " prop"] }));
    }
    return ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [render ? (render({
                onClick() {
                    var _a;
                    (_a = inputRef.current) === null || _a === void 0 ? void 0 : _a.click();
                },
            })) : ((0, jsx_runtime_1.jsx)("button", { type: "button", "data-testid": dataTestId, onClick: () => {
                    var _a;
                    (_a = inputRef.current) === null || _a === void 0 ? void 0 : _a.click();
                }, className: (0, join_classes_1.classNames)(isStringPicker ? pickerBtnClassName : ""), children: pickerBtnText })), (0, jsx_runtime_1.jsx)("input", { value: "", type: "file", id: inputId, "data-testid": inputId, multiple: multiple, accept: allowedFileTypes.join(","), style: { display: "none" }, autoComplete: "new-password", onChange: (e) => {
                    pickFileHandler(e);
                }, ref: (node) => (inputRef.current = node) })] }));
}
